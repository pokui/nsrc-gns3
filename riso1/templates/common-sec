# Configs after improvements from the "sec" lab

##### IOSV #####

preamble_iosv () {
  ISIS_ENABLE="${1:-Y}"
  cat <<EOS
!
version 15.7
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
!
hostname ${HOSTNAME}
!
logging buffered 16384
no logging console
enable secret 5 \$1\$b3/k\$jNHoF35fzOxYKUTFO0Ef3/
!
aaa new-model
!
aaa authentication login default local
aaa authentication enable default enable
!
clock timezone AEST 10 0
!
no ip source-route
!
no ip domain lookup
ip domain name ws.nsrc.org
ip cef
no ipv6 source-route
ipv6 unicast-routing
ipv6 cef
!
EOS
  [ "${ISIS_ENABLE}" = "Y" ] && cat <<EOS
key chain as${AS}-key
 key 1
  key-string 7 0706325C42081B
!
EOS
  cat <<EOS
!
username isplab secret 5 \$1\$vPNP\$hA1Tq3C05ByW2G31WA0wh0
!
ip tcp path-mtu-discovery
!
EOS
}

postamble_iosv () {
  cat <<EOS
!
ip forward-protocol nd
!
no ip http server
no ip http secure-server
ip ssh source-interface Loopback0
ip ssh version 2
!
ip access-list standard SNMP
 permit 100.68.${GROUP}.30
 deny   any log
!
ip access-list extended ipv4-vty
 permit ip 100.68.${GROUP}.0 0.0.0.15 any
 deny   ip any any log
!
logging trap debugging
logging facility local4
logging source-interface Loopback0
!
snmp-server community NetManage RO SNMP
snmp-server ifindex persist
snmp-server trap-source Loopback0
snmp-server source-interface informs Loopback0
snmp-server location NSRC Lab
!
ipv6 access-list ipv6-vty
 permit ipv6 2001:DB8:${GROUP}::/64 any
 deny ipv6 any any log
!
banner exec ^
^
banner incoming ^
**************************************************************************
* IOSv is strictly limited to use for evaluation, demonstration and IOS  *
* education. IOSv is provided as-is and is not supported by Cisco's      *
* Technical Advisory Center. Any use or disclosure, in whole or in part, *
* of the IOSv Software or Documentation to any third party for any       *
* purposes is expressly prohibited except as otherwise authorized by     *
* Cisco in writing.                                                      *
**************************************************************************^
banner login ^
Routing Infrastructure and Security Operations Workshop Lab
          Network Startup Resource Center
^
!
line con 0
 exec-timeout 15 0
 transport preferred none
 transport output ssh
line aux 0
 exec-timeout 15 0
 transport preferred none
 transport output ssh
line vty 0 4
 access-class ipv4-vty in
 exec-timeout 15 0
 ipv6 access-class ipv6-vty in
 transport preferred none
 transport input ssh
 transport output ssh
!
end
EOS
}

##### CSR1000V #####

preamble_csrv () {
  ISIS_ENABLE="${1:-Y}"
  cat <<EOS
!
version 16.6
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
!
hostname ${HOSTNAME}
!
logging buffered 16384
no logging console
enable secret 5 \$1\$b3/k\$jNHoF35fzOxYKUTFO0Ef3/
!
aaa new-model
!
aaa authentication login default local
aaa authentication enable default enable
!
clock timezone AEST 10 0
no ip source-route
!
no ip domain lookup
ip domain name ws.nsrc.org
!
no ipv6 source-route
ipv6 unicast-routing
!
EOS
  [ "${ISIS_ENABLE}" = "Y" ] && cat <<EOS
key chain as${AS}-key
 key 1
  key-string 7 0706325C42081B
!
EOS
  cat <<EOS
username isplab secret 5 \$1\$vPNP\$hA1Tq3C05ByW2G31WA0wh0
!
EOS
}

postamble_csrv () {
  cat <<EOS
!
ip forward-protocol nd
ip tcp path-mtu-discovery
no ip http server
no ip http secure-server
!
ip ssh source-interface Loopback0
ip ssh version 2
!
ip access-list standard SNMP
 permit 100.68.${GROUP}.30
 deny   any log
!
ip access-list extended ipv4-vty
 permit ip 100.68.${GROUP}.0 0.0.0.15 any
 deny   ip any any log
logging trap debugging
logging facility local4
logging source-interface Loopback0
!
snmp-server community NetManage RO SNMP
snmp-server trap-source Loopback0
snmp-server source-interface informs Loopback0
snmp-server location NSRC Lab
snmp ifmib ifindex persist
!
ipv6 access-list ipv6-vty
 permit ipv6 2001:DB8:${GROUP}::/64 any
 deny ipv6 any any log
!
banner login ^
Routing Infrastructure and Security Operations Workshop
          Network Startup Resource Center
^
!
line con 0
 exec-timeout 15 0
 transport preferred none
 transport output ssh
line vty 0 4
 access-class ipv4-vty in
 exec-timeout 15 0
 ipv6 access-class ipv6-vty in
 transport preferred none
 transport input ssh
 transport output ssh
!
end
EOS
}
